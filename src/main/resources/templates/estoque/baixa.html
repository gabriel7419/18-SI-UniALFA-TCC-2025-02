<!-- Tela de baixa de estoque -->
<!DOCTYPE html>
<!-- Puxa o layout principal -->
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout (~{::title/text()}, ~{::section}, ~{::script})}">
<head>
</head>
<body>
<section>
    <!-- Alerta de erro, só aparece se o controller mandar a 'errorMessage' -->
    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${errorMessage}">Erro ao registrar baixa no estoque.</span>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="card card-primary">
        <div class="card-header card-header-blue">
            <h3 class="card-title">Baixa em Produtos do Estoque</h3>
        </div>
        <div class="card-body">
            <!-- Formulário de busca pra filtrar produto -->
            <form th:action="@{/estoque/baixa}" method="get" class="mb-4">
                <div class="input-group mb-3">
                    <input type="text" name="filtro" class="form-control" placeholder="Buscar produto por nome..." th:value="${filtro}">
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="submit">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="tipo" class="mr-2">Tipo:</label>
                    <select id="tipo" name="tipo" class="form-control">
                        <option value="">Todos</option>
                        <option value="Alimento" th:selected="${tipo == 'Alimento'}">Alimento</option>
                        <option value="Higiene" th:selected="${tipo == 'Higiene'}">Higiene</option>
                        <option value="Limpeza" th:selected="${tipo == 'Limpeza'}">Limpeza</option>
                    </select>
                </div>
            </form>

            <!-- Tabela com os produtos -->
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th>Nome</th>
                    <th style="width: 120px;">Qtd. Atual</th>
                    <th style="width: 150px;">Unidade</th>
                    <th style="width: 250px;">Quantidade para Baixa</th>
                </tr>
                </thead>
                <tbody>
                <!-- Loop pra mostrar cada produto -->
                <tr th:each="produto : ${produtos}">
                    <td th:text="${produto.nome}">Arroz</td>
                    <td th:text="${produto.quantidade}">50</td>
                    <td th:text="${produto.unidade.nome}">kg</td>
                    <td>
                        <!-- Form pra dar baixa em cada produto -->
                        <form th:action="@{/estoque/dar-baixa}" method="post" class="form-inline">
                            <!-- ID do produto escondido -->
                            <input type="hidden" name="produtoId" th:value="${produto.id}" />
                            <div class="input-group">
                                <!-- Campo pra por a quantidade da baixa -->
                                <!-- min="1" não deixa por menos de 1 -->
                                <!-- th:max não deixa tirar mais do que tem -->
                                <input type="number" name="quantidade" class="form-control" placeholder="0" min="1" th:max="${produto.quantidade}" required>
                                <div class="input-group-append">
                                    <button type="submit" class="btn btn-success">Salvar</button>
                                </div>
                            </div>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>
<script>

</script>
</body>
</html>